{
  "networks": [
    {
      "name": "web",
      "driver": "overlay"
    }
  ],
  "stacks": [
    {
      "name": "hub",
      "services": [
        {
          "name": "webproxy",
          "image": "traefik:1.5",
          "args": [
            "--api",
            "--docker",
            "--docker.swarmmode",
            "--docker.domain=example.com",
            "--docker.exposedbydefault=false",
            "--docker.watch"
          ],
          "volumes": [
            {
              "type": "bind",
              "source": "/var/run/docker.sock",
              "target": "/var/run/docker.sock",
              "is_read_only": true
            },
            {
              "type": "volume",
              "source": "acme",
              "target": "/etc/traefik/acme"
            }
          ],
          "ports": [
            {
              "target": 80,
              "published": 80,
              "mode": "host"
            },
            {
              "target": 443,
              "published": 443,
              "mode": "host"
            },
            {
              "target": 8080,
              "published": 8080,
              "mode": "host"
            }
          ],
          "placement": {
            "constraints": [
              "node.role == manager"
            ]
          },
          "restart_policy": {
            "condition": "on-failure"
          },
          "networks": [
            {
              "name": "web",
              "is_external": true
            }
          ]
        }
      ],
      "volumes": [
        {
          "name": "acme"
        }
      ]
    },
    {
      "name": "test_butt_nz",
      "networks": [
        {
          "name": "ssb",
          "driver": "overlay",
          "is_attachable": true
        }
      ],
      "services": [
        {
          "name": "peer-server",
          "image": "buttcloud/buttpub-peer-server",
          "ports": [
            {
              "target": 8008,
              "published": 8008,
              "mode": "host"
            }
          ],
          "env": {
            "ssb_host": "0.0.0.0",
            "ssb_externalHost": "test.butt.nz"
          },
          "volumes": [
            {
              "type": "volume",
              "source": "ssb",
              "target": "/home/node/.ssb"
            }
          ],
          "labels": {
            "traefik.enable": false
          },
          "restart_policy": {
            "condition": "on-failure"
          },
          "networks": [
            {
              "name": "ssb"
            }
          ]
        },
        {
          "name": "landing",
          "image": "buttcloud/buttpub-landing",
          "env": {
            "ssb_host": "test_butt_nz__peer-server",
            "ssb_landing__host": "0.0.0.0"
          },
          "volumes": [
            {
              "type": "volume",
              "source": "ssb",
              "target": "/home/node/.ssb"
            }
          ],
          "labels": {
            "traefik.enable": true,
            "traefik.backend": "test_butt_nz_landing",
            "traefik.port": 8901,
            "traefik.frontend.rule": "Host:test.butt.nz",
            "traefik.docker.network": "web"
          },
          "networks": [
            {
              "name": "ssb"
            },
            {
              "name": "web",
              "is_external": true
            }
          ]
        }
      ],
      "volumes": [
        {
          "name": "ssb"
        }
      ]
    }
  ]
}